"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[904],{23586:function(o,e,n){n.r(e),n.d(e,{demos:function(){return r}});var a=n(67294),t=n(65471),r={}},44401:function(o,e,n){n.r(e),n.d(e,{demos:function(){return r}});var a=n(67294),t=n(26211),r={}},39817:function(o,e,n){n.r(e),n.d(e,{demos:function(){return r}});var a=n(67294),t=n(31746),r={}},95796:function(o,e,n){n.r(e),n.d(e,{demos:function(){return r}});var a=n(67294),t=n(30372),r={}},41386:function(o,e,n){n.r(e),n.d(e,{demos:function(){return r}});var a=n(67294),t=n(94397),r={}},63124:function(o,e,n){n.r(e),n.d(e,{demos:function(){return r}});var a=n(67294),t=n(20898),r={}},97230:function(o,e,n){n.r(e),n.d(e,{demos:function(){return r}});var a=n(67294),t=n(47194),r={}},87288:function(o,e,n){n.r(e),n.d(e,{demos:function(){return r}});var a=n(67294),t=n(78991),r={}},11171:function(o,e,n){n.r(e),n.d(e,{demos:function(){return r}});var a=n(67294),t=n(68537),r={}},63729:function(o,e,n){n.r(e),n.d(e,{demos:function(){return r}});var a=n(67294),t=n(42077),r={}},44370:function(o,e,n){n.r(e),n.d(e,{texts:function(){return t}});var a=n(65471);const t=[{value:`.env                            # \u516C\u5171\u914D\u7F6E
.env.development                # \u672C\u5730\u5F00\u53D1\u73AF\u5883\u914D\u7F6E\u6587\u4EF6
.env.mock                       # \u672C\u5730mock\u73AF\u5883\u914D\u7F6E\u6587\u4EF6
.env.test                       # \u6D4B\u8BD5\u73AF\u5883\u914D\u7F6E\u6587\u4EF6
.env.production                 # \u6B63\u5F0F\u73AF\u5883\u914D\u7F6E\u6587\u4EF6
`,paraId:0,tocIndex:1},{value:"\u5F53\u524D\u9879\u76EE\u7684 ",paraId:1,tocIndex:3},{value:"package name",paraId:1,tocIndex:3},{value:"\u7EBF\u4E0A\u8DEF\u7531\u7684 ",paraId:2,tocIndex:4},{value:"basename",paraId:2,tocIndex:4},{value:"\uFF0C\u4F8B\u5982\uFF1A\u90E8\u7F72\u7684\u9879\u76EE\u7EDF\u4E00\u653E\u5728 ",paraId:2,tocIndex:4},{value:"/gatekeeper/\u9879\u76EE\u540D",paraId:2,tocIndex:4},{value:" \u4E0B",paraId:2,tocIndex:4},{value:"ant \u6837\u5F0F\u524D\u7F00\uFF0C\u89E3\u51B3\u4E3B\u5E94\u7528\u548C\u5B50\u5E94\u7528\u7684\u6837\u5F0F\u95EE\u9898",paraId:3,tocIndex:5},{value:"\u7F16\u8BD1\u73AF\u5883",paraId:4,tocIndex:6},{value:"\u542B\u4E49",paraId:4,tocIndex:6},{value:"development",paraId:4,tocIndex:6},{value:"\u672C\u5730\u5F00\u53D1\u73AF\u5883",paraId:4,tocIndex:6},{value:"mock",paraId:4,tocIndex:6},{value:"mock \u73AF\u5883",paraId:4,tocIndex:6},{value:"test",paraId:4,tocIndex:6},{value:"\u6D4B\u8BD5\u73AF\u5883",paraId:4,tocIndex:6},{value:"production",paraId:4,tocIndex:6},{value:"\u6B63\u5F0F\u73AF\u5883",paraId:4,tocIndex:6},{value:"\u7F16\u8BD1\u73AF\u5883",paraId:5,tocIndex:7},{value:"\u5BF9\u5E94\u7684\u503C",paraId:5,tocIndex:7},{value:"development",paraId:5,tocIndex:7},{value:"\u672C\u5730\u5F00\u53D1\u73AF\u5883\u65E0\u9700\u914D\u7F6E",paraId:5,tocIndex:7},{value:"mock",paraId:5,tocIndex:7},{value:"mock \u73AF\u5883\u65E0\u9700\u914D\u7F6E",paraId:5,tocIndex:7},{value:"test",paraId:5,tocIndex:7},{value:"https://static2.test.xxx.com",paraId:5,tocIndex:7},{value:"production",paraId:5,tocIndex:7},{value:"https://s1.xxcdn.com",paraId:5,tocIndex:7},{value:"\u9759\u6001\u8D44\u6E90\u5B58\u653E\u5730\u5740\uFF1A",paraId:6,tocIndex:8},{value:"$VITE_STATIC_ORIGIN/yx/$npm_package_name/dist",paraId:6,tocIndex:8},{value:"\u53EF\u6839\u636E\u5177\u4F53\u9879\u76EE\u8FDB\u884C\u914D\u7F6E\uFF0C\u4E5F\u53EF\u914D\u7F6E\u591A\u4E2A",paraId:7,tocIndex:9},{value:"\u7F16\u8BD1\u73AF\u5883",paraId:8,tocIndex:9},{value:"\u5BF9\u5E94\u7684\u503C",paraId:8,tocIndex:9},{value:"development",paraId:8,tocIndex:9},{value:"/proxy_url",paraId:8,tocIndex:9},{value:"\uFF1A\u672C\u5730\u5F00\u53D1\u53EF\u80FD\u9700\u8981\u914D\u7F6E\u8DE8\u57DF",paraId:8,tocIndex:9},{value:"mock",paraId:8,tocIndex:9},{value:"mock \u73AF\u5883\u65E0\u9700\u914D\u7F6E",paraId:8,tocIndex:9},{value:"test",paraId:8,tocIndex:9},{value:"https://m.test.xxx.com",paraId:8,tocIndex:9},{value:"production",paraId:8,tocIndex:9},{value:"https://m.xxx.com",paraId:8,tocIndex:9},{value:"vite-env.d.ts",paraId:9,tocIndex:10},{value:" \u6587\u4EF6",paraId:9,tocIndex:10},{value:`/// <reference types="vite/client" />

/**
 * \u7F16\u8BD1\u73AF\u5883
 */
declare type BuildEnv = 'development' | 'mock' | 'test' | 'production';

/**
 * \u591A\u7F16\u8BD1\u73AF\u5883\u53D8\u91CF\u7EA6\u675F
 */
declare type MultiEnv<T = string> = Record<BuildEnv, T>;

interface ImportMetaEnv {
  /** \u4E91\u6548basename */
  readonly VITE_BASE_ROUTE_NAME: string;
  /** \u9759\u6001\u8D44\u6E90 url */
  readonly VITE_PUBLIC_URL: string;
  /** \u63A5\u53E3\u8BF7\u6C42\u57DF\u540D */
  readonly VITE_ORIGIN: string;
  // \u66F4\u591A\u73AF\u5883\u53D8\u91CF...
}

interface ImportMeta {
  readonly env: ImportMetaEnv;
}
`,paraId:10,tocIndex:10},{value:"\u4F7F\u7528 ",paraId:11,tocIndex:11},{value:"--mode",paraId:11,tocIndex:11},{value:" \u6CE8\u5165\u5BF9\u5E94\u7684\u6587\u4EF6",paraId:11,tocIndex:11},{value:`"scripts": {
  "dev": "vite --mode development"
},
`,paraId:12,tocIndex:11},{value:"\u76F4\u63A5\u6CE8\u5165\u73AF\u5883\u53D8\u91CF\uFF1A",paraId:13,tocIndex:11},{value:`"scripts": {
  "build-analyze": "VITE_BUILD_ANALYZER=true yarn build-prod"
},
`,paraId:14,tocIndex:11},{value:"\u4F7F\u7528 vite \u5BFC\u51FA\u7684 ",paraId:15,tocIndex:13},{value:"loadEnv",paraId:15,tocIndex:13},{value:" \u51FD\u6570\u6765\u52A0\u8F7D\u6307\u5B9A\u7684 ",paraId:15,tocIndex:13},{value:".env",paraId:15,tocIndex:13},{value:" \u6587\u4EF6\u3002",paraId:15,tocIndex:13},{value:`export default defineConfig(({ mode, command }: ConfigEnv) => {
  const {
    VITE_PUBLIC_URL = '/',
    VITE_BUILD_ANALYZER
  } = loadEnv(mode, process.cwd());
});
`,paraId:16,tocIndex:13},{value:`const { MODE } = import.meta.env;
`,paraId:17,tocIndex:14}]},9978:function(o,e,n){n.r(e),n.d(e,{texts:function(){return t}});var a=n(26211);const t=[{value:"\u786E\u4FDD\u6B63\u786E\u5B89\u88C5 ",paraId:0,tocIndex:1},{value:"Node.js",paraId:0,tocIndex:1},{value:" \u4E14\u7248\u672C\u4E3A ",paraId:0,tocIndex:1},{value:"20+",paraId:0,tocIndex:1},{value:"\u3002",paraId:0,tocIndex:1},{value:`$ node -v
v20.19.0
`,paraId:1,tocIndex:1},{value:`$ npx @enode/create-project download @enode/qiankun-main-template
`,paraId:2,tocIndex:3},{value:`$ npx @enode/create-project download @enode/qiankun-mic-template
`,paraId:3,tocIndex:4},{value:"\u76EE\u524D\u4E3B\u5E94\u7528\u548C\u5B50\u5E94\u7528\u7684\u6A21\u7248\u5DF2\u7ECF\u96C6\u6210\u5230\u53EF\u89C6\u5316\u5DE5\u5177\u4E2D\uFF0C\u4E5F\u53EF\u4EE5\u901A\u8FC7\u53EF\u89C6\u5316\u5DE5\u5177\u4E00\u952E\u4E0B\u8F7D",paraId:4,tocIndex:5},{value:"qiankun \u5B98\u65B9\u6587\u6863",paraId:5,tocIndex:6}]},44599:function(o,e,n){n.r(e),n.d(e,{texts:function(){return t}});var a=n(31746);const t=[{value:"\u672C\u5730\u5F00\u53D1\u65F6\uFF0C\u5B50\u5E94\u7528\u63A5\u53E3\u8BF7\u6C42\u53EF\u80FD\u4F1A\u53D1\u751F\u8DE8\u57DF\uFF0C\u56E0\u6B64\u53EF\u4EE5\u5728\u4E3B\u5E94\u7528\u4E2D\u914D\u7F6E\u4EE3\u7406\u505A\u63A5\u53E3\u8F6C\u53D1\uFF0C\u4F8B\u5982\uFF1A",paraId:0,tocIndex:1},{value:`headers: {
  'Access-Control-Allow-Origin': '*'
},
// \u914D\u7F6E\u4EE3\u7406\uFF0C\u5904\u7406\u672C\u5730\u5F00\u53D1\u8DE8\u57DF\u95EE\u9898
proxy: {
  '/proxy_url': {
    target: 'https://xxx.test.xxx.com',
    changeOrigin: true,
    rewrite: (path) => path.replace(/^\\/proxy_url/, '')
  }
}
`,paraId:1,tocIndex:1},{value:`import { defineConfig, loadEnv } from 'vite';
import type { ConfigEnv } from 'vite';
import react from '@vitejs/plugin-react';
import legacy from '@vitejs/plugin-legacy';
import autoprefixer from 'autoprefixer';
import { visualizer } from 'rollup-plugin-visualizer';
import { viteMockServe } from 'vite-plugin-mock';
import { manualChunksPlugin } from 'vite-plugin-webpackchunkname';
import checker from 'vite-plugin-checker';
import { moveScriptsToBody } from './plugins/moveScriptsToBody';

// \u5F15\u5165 path \u5305\u6CE8\u610F\u4E24\u70B9:
// 1. \u4E3A\u907F\u514D\u7C7B\u578B\u62A5\u9519\uFF0C\u4F60\u9700\u8981\u901A\u8FC7 \`pnpm i @types/node -D\` \u5B89\u88C5\u7C7B\u578B
// 2. tsconfig.node.json \u4E2D\u8BBE\u7F6E \`allowSyntheticDefaultImports: true\`\uFF0C\u4EE5\u5141\u8BB8\u4E0B\u9762\u7684 default \u5BFC\u5165\u65B9\u5F0F
import { resolve } from 'path';

// https://vitejs.dev/config/
/** @type {import('vite').UserConfig} */
export default defineConfig(({ mode, command }: ConfigEnv) => {
  const {
    VITE_PUBLIC_URL = '/',
    VITE_BUILD_ANALYZER
  } = loadEnv(mode, process.cwd());

  return {
    // \u9759\u6001\u8D44\u6E90\u8DEF\u5F84
    base: command === 'build' ? VITE_PUBLIC_URL : '/',
    resolve: {
      // \u8BBE\u7F6E\u8DEF\u5F84\u522B\u540D
      alias: {
        '@': resolve(__dirname, 'src'),
        src: resolve(__dirname, 'src'),
        '@assets': resolve(__dirname, 'src/assets')
      }
    },
    css: {
      // \u8FDB\u884C PostCSS \u914D\u7F6E
      postcss: {
        plugins: [autoprefixer()]
      }
    },
    // \u672C\u5730\u5F00\u53D1\u914D\u7F6E
    server: {
      host: true,
      port: 8080,
      open: true,
      headers: {
        'Access-Control-Allow-Origin': '*'
      },
      // \u914D\u7F6E\u4EE3\u7406\uFF0C\u5904\u7406\u672C\u5730\u5F00\u53D1\u8DE8\u57DF\u95EE\u9898
      proxy: {
        '/proxy_url': {
          target: 'https://xxx.test.xxx.com',
          changeOrigin: true,
          rewrite: (path) => path.replace(/^\\/proxy_url/, '')
        }
      }
    },
    // \u6784\u5EFA\u914D\u7F6E
    build: {
      // \u751F\u6210sourcemap\u6587\u4EF6
      sourcemap: true,
      minify: 'terser',
      terserOptions: {
        compress: {
          // \u751F\u4EA7\u73AF\u5883\u5220\u9664console.log
          pure_funcs: mode === 'production' ? ['console.log'] : []
        }
      },
    },
    plugins: [
      checker({
        typescript: true
      }),
      react({
        jsxImportSource: "@emotion/react",
      }),
      // \u6253\u5305\u540E\u7684\u4EA7\u7269\u81EA\u5B9A\u4E49\u547D\u540D
      manualChunksPlugin(),
      // \u8BED\u6CD5\u964D\u7EA7\u4E0EPolyfill
      legacy({
        // \u8BBE\u7F6E\u76EE\u6807\u6D4F\u89C8\u5668\uFF0Cbrowserslist \u914D\u7F6E\u8BED\u6CD5
        targets: [
          'chrome >= 64',
          'edge >= 79',
          'safari >= 11.1',
          'firefox >= 67'
        ],
      }),
      // \u81EA\u5B9A\u4E49\u63D2\u4EF6\uFF0C\u5C06\u811A\u672C\u79FB\u52A8\u5230body\u5E95\u90E8
      moveScriptsToBody(),
      // mock\u670D\u52A1
      mode === 'mock' &&
      viteMockServe({
        // default
        mockPath: 'mock'
      }),
      // \u6784\u5EFA\u4EA7\u7269\u5206\u6790
      VITE_BUILD_ANALYZER &&
      visualizer({
        // \u6253\u5305\u5B8C\u6210\u540E\u81EA\u52A8\u6253\u5F00\u6D4F\u89C8\u5668\uFF0C\u663E\u793A\u4EA7\u7269\u4F53\u79EF\u62A5\u544A
        open: true,
        gzipSize: true,
        brotliSize: true
      }),
    ]
  };
});
`,paraId:2,tocIndex:2}]},90859:function(o,e,n){n.r(e),n.d(e,{texts:function(){return t}});var a=n(30372);const t=[{value:`import { HomeOutlined, SettingOutlined } from '@ant-design/icons';

const { VITE_ORIGIN } = import.meta.env;

/**
 * \u83B7\u53D6\u5B50\u5E94\u7528\u9759\u6001 HTML \u7684\u5730\u5740
 * @param name \u5E94\u7528\u540D
 * @returns \u9759\u6001 HTML \u7684\u5730\u5740
 */
function getOpsWebPath(name: string) {
  return \`\${VITE_ORIGIN}/gatekeeper/\${name}?v=\${Date.now()}\`; // \u52A0\u65F6\u95F4\u6233\u9632\u6B62\u7F13\u5B58
}

export interface Router {
  title: string;
  /** \u5B50\u5E94\u7528\u7684\u8DEF\u7531\u8DEF\u5F84 */
  path: string;
  /**
   * \u672C\u5730\u8C03\u8BD5\u65F6\uFF0C\u5B50\u5E94\u7528 html \u5165\u53E3\u5730\u5740
   *  - \u793A\u4F8B \u261E  http://localhost:9001/
   *  - \u5982\u4E0D\u9700\u8981\u5728\u57FA\u5EA7\u4E2D\u8C03\u8BD5\uFF0C\u76F4\u63A5\u79FB\u9664\u6216\u6CE8\u91CA devEntryUrl
   */
  devEntryUrl?: string;
  /** \u5B50\u5E94\u7528\u7684 html \u5165\u53E3\u5730\u5740 */
  entryUrl?: string;
  activeIcon: React.ReactNode;
  inactiveIcon: React.ReactNode;
  childRoutes?: Router[];
}

export const ROUTES: Router[] = [
  {
    title: '\u5B50\u5E94\u7528A',
    path: 'qiankun-mic-a',
    // \u672C\u5730\u8C03\u8BD5\u5B50\u5E94\u7528\u7684\u5730\u5740\uFF0C\u4E0D\u914D\u7F6E\u5219\u4E0D\u8C03\u8BD5\u672C\u5730
    devEntryUrl: '//localhost:9091',
    entryUrl: getOpsWebPath('qiankun-mic-a'),
    activeIcon: <HomeOutlined twoToneColor="#eb2f96" />,
    inactiveIcon: <HomeOutlined />,
  },
  {
    title: '\u5D4C\u5957\u83DC\u5355',
    path: 'global-config',
    activeIcon: <SettingOutlined twoToneColor="#eb2f96" />,
    inactiveIcon: <SettingOutlined />,
    childRoutes: [
      {
        title: '\u5B50\u5E94\u7528B',
        path: 'qiankun-mic-b',
        // \u672C\u5730\u8C03\u8BD5\u5B50\u5E94\u7528\u7684\u5730\u5740\uFF0C\u4E0D\u914D\u7F6E\u5219\u4E0D\u8C03\u8BD5\u672C\u5730
        devEntryUrl: '//localhost:9092',
        entryUrl: getOpsWebPath('qiankun-mic-b'),
        activeIcon: <HomeOutlined twoToneColor="#eb2f96" />,
        inactiveIcon: <HomeOutlined />,
      },
    ],
  },
];
`,paraId:0,tocIndex:1},{value:"\u6548\u679C",paraId:1,tocIndex:1},{value:`/**
 * \u83B7\u53D6\u5B50\u5E94\u7528\u914D\u7F6E
 * @param route \u8DEF\u7531
 * @param state \u9700\u8981\u5411\u5B50\u5E94\u7528\u4F20\u9012\u7684\u72B6\u6001\u6570\u636E
 * @returns \u5B50\u5E94\u7528
 */
function getMicroApp(
  { path, devEntryUrl, entryUrl }: Router,
  rootNavigate: NavigateFunction,
): RegistrableApp<object> {
  const { MODE, VITE_REACT_APP_NAME } = import.meta.env;
  // \u5141\u8BB8\u672C\u5730\u8C03\u8BD5\u5FAE\u524D\u7AEF\u5B50\u5E94\u7528
  const isLocalMode =
    MODE === 'development' && (isDev || isMock) && !!devEntryUrl;
  const entry = isLocalMode ? devEntryUrl : entryUrl;

  const rootBasename =
    MODE === 'development' ? \`/\${path}\` : \`\${ROOT_BASENAME}/\${path}\`;

  return {
    name: path, // app name registered
    entry: entry as string,
    container: \`#\${VITE_REACT_APP_NAME}-content\`,
    activeRule: rootBasename,
    props: {
      // \u5B50\u5E94\u7528\u9700\u8981\u8BBE\u7F6E\u7684basename
      rootBasename,
      // \u4E3B\u5E94\u7528\u8DEF\u7531\u65B9\u6CD5
      rootNavigate,
    },
  };
}
`,paraId:2,tocIndex:3},{value:`import { FLATTENED_ROUTES } from '@/router/mic-routes';
import { registerMicroApps, start } from 'qiankun';
import type { NavigateFunction } from 'react-router-dom';

type State = {
  rootNavigate: NavigateFunction;
};

/**
 * \u542F\u52A8\u5FAE\u524D\u7AEF\u5E94\u7528
 * @param state \u9700\u8981\u5411\u5B50\u5E94\u7528\u4F20\u9012\u7684\u72B6\u6001\u6570\u636E
 */
export function startMicroApp({ rootNavigate }: State) {
  const microApps = FLATTENED_ROUTES.filter((route) => !!route.entryUrl).map(
    (route) => getMicroApp(route, rootNavigate),
  );
  // \u6CE8\u518C\u5B50\u5E94\u7528
  registerMicroApps(microApps);
  // \u542F\u52A8\u5B50\u5E94\u7528
  start();
}
`,paraId:3,tocIndex:4},{value:"\u5B50\u5E94\u7528\u6302\u8F7D\u7684\u8282\u70B9",paraId:4,tocIndex:5},{value:"<div id={`${import.meta.env.VITE_REACT_APP_NAME}-content`}></div>\n",paraId:5,tocIndex:5}]},77565:function(o,e,n){n.r(e),n.d(e,{texts:function(){return t}});var a=n(94397);const t=[{value:`/*
 * react-router-dom \u5B98\u65B9\u6587\u6863
 * https://reactrouter.com/en/main
 */
import Suspenselazy from '@/components/Suspenselazy';
import { RouteObject, createBrowserRouter } from 'react-router-dom';
import { isLocal } from '@/utils/env';

const Home = Suspenselazy(
  () => import(/* webpackChunkName:"home" */ '@/pages/Home')
);

const Empty = Suspenselazy(
  () => import(/* webpackChunkName:"empty" */ '@/pages/Empty')
);

const routes: RouteObject[] = [
  {
    path: '/',
    element: Home,
    children: [
      {
        path: '*'
      }
    ]
  },
  {
    path: 'empty',
    element: Empty
  },
  // \u672A\u5339\u914D\u5230\u9875\u9762
  {
    path: '*',
    element: Empty
  }
];

// \u83B7\u53D6\u57FA\u7840\u8DEF\u7531\u540D
const { VITE_BASE_ROUTE_NAME } = import.meta.env;

// \u521B\u5EFA\u8DEF\u7531
const router = createBrowserRouter(routes, {
  // \u533A\u5206\u672C\u5730\u548C\u7EBF\u4E0A
  basename: isLocal ? '/' : VITE_BASE_ROUTE_NAME,
});

export default router;
`,paraId:0,tocIndex:1},{value:`import router from '@/router';
import { RouterProvider } from 'react-router-dom';

function App() {
  return <RouterProvider router={router} />;
}

export default App;
`,paraId:1,tocIndex:2}]},96953:function(o,e,n){n.r(e),n.d(e,{texts:function(){return t}});var a=n(20898);const t=[{value:`import { defineConfig, loadEnv } from 'vite';
import qiankun from 'vite-plugin-qiankun';

export default defineConfig(({ mode, command }) => {
  const { VITE_REACT_APP_NAME } = loadEnv(mode, process.cwd());

  return {
    plugins: [
      // \u5FAE\u5E94\u7528\u540D\u5B57\uFF0C\u4E0E\u4E3B\u5E94\u7528\u6CE8\u518C\u7684\u5FAE\u5E94\u7528\u540D\u5B57\u4FDD\u6301\u4E00\u81F4
      qiankun(VITE_REACT_APP_NAME, {
        useDevMode: true,
      }),
    ],
  };
});
`,paraId:0,tocIndex:1},{value:`import { defineConfig, loadEnv } from 'vite';
import type { ConfigEnv } from 'vite';
import react from '@vitejs/plugin-react';
import legacy from '@vitejs/plugin-legacy';
import qiankun from 'vite-plugin-qiankun';
import autoprefixer from 'autoprefixer';
import { visualizer } from 'rollup-plugin-visualizer';
import { viteMockServe } from 'vite-plugin-mock';
import { manualChunksPlugin } from 'vite-plugin-webpackchunkname';
import checker from 'vite-plugin-checker';
import { moveScriptsToBody } from './plugins/moveScriptsToBody';

// \u5F15\u5165 path \u5305\u6CE8\u610F\u4E24\u70B9:
// 1. \u4E3A\u907F\u514D\u7C7B\u578B\u62A5\u9519\uFF0C\u4F60\u9700\u8981\u901A\u8FC7 \`pnpm i @types/node -D\` \u5B89\u88C5\u7C7B\u578B
// 2. tsconfig.node.json \u4E2D\u8BBE\u7F6E \`allowSyntheticDefaultImports: true\`\uFF0C\u4EE5\u5141\u8BB8\u4E0B\u9762\u7684 default \u5BFC\u5165\u65B9\u5F0F
import { resolve } from 'path';

// https://vitejs.dev/config/
/** @type {import('vite').UserConfig} */
export default defineConfig(({ mode, command }: ConfigEnv) => {
  const {
    VITE_PUBLIC_URL = '/',
    VITE_BUILD_ANALYZER,
    VITE_REACT_APP_NAME
  } = loadEnv(mode, process.cwd());

  return {
    // \u9759\u6001\u8D44\u6E90\u8DEF\u5F84
    base: command === 'build' ? VITE_PUBLIC_URL : '/',
    resolve: {
      // \u8BBE\u7F6E\u8DEF\u5F84\u522B\u540D
      alias: {
        '@': resolve(__dirname, 'src'),
        src: resolve(__dirname, 'src'),
        '@assets': resolve(__dirname, 'src/assets')
      }
    },
    css: {
      // \u8FDB\u884C PostCSS \u914D\u7F6E
      postcss: {
        plugins: [autoprefixer()]
      }
    },
    // \u672C\u5730\u5F00\u53D1\u914D\u7F6E
    server: {
      host: true,
      port: 9091,
      open: true,
      headers: {
        'Access-Control-Allow-Origin': '*'
      },
      // \u914D\u7F6E\u4EE3\u7406\uFF0C\u5904\u7406\u672C\u5730\u5F00\u53D1\u8DE8\u57DF\u95EE\u9898
      proxy: {
        '/proxy_url': {
          target: 'https://xxx.test.xxx.com',
          changeOrigin: true,
          rewrite: (path) => path.replace(/^\\/proxy_url/, '')
        }
      }
    },
    // \u6784\u5EFA\u914D\u7F6E
    build: {
      // \u751F\u6210sourcemap\u6587\u4EF6
      sourcemap: true,
      minify: 'terser',
      terserOptions: {
        compress: {
          // \u751F\u4EA7\u73AF\u5883\u5220\u9664console.log
          pure_funcs: mode === 'production' ? ['console.log'] : []
        }
      },
    },
    plugins: [
      checker({
        typescript: true
      }),
      react({
        jsxImportSource: "@emotion/react",
      }),
      // \u5FAE\u5E94\u7528\u540D\u5B57\uFF0C\u4E0E\u4E3B\u5E94\u7528\u6CE8\u518C\u7684\u5FAE\u5E94\u7528\u540D\u5B57\u4FDD\u6301\u4E00\u81F4
      qiankun(VITE_REACT_APP_NAME, {
        useDevMode: true
      }),
      // \u6253\u5305\u540E\u7684\u4EA7\u7269\u81EA\u5B9A\u4E49\u547D\u540D
      manualChunksPlugin(),
      // \u8BED\u6CD5\u964D\u7EA7\u4E0EPolyfill
      legacy({
        // \u8BBE\u7F6E\u76EE\u6807\u6D4F\u89C8\u5668\uFF0Cbrowserslist \u914D\u7F6E\u8BED\u6CD5
        targets: [
          'chrome >= 64',
          'edge >= 79',
          'safari >= 11.1',
          'firefox >= 67'
        ],
      }),
      // \u81EA\u5B9A\u4E49\u63D2\u4EF6\uFF0C\u5C06\u811A\u672C\u79FB\u52A8\u5230body\u5E95\u90E8
      moveScriptsToBody(),
      // mock\u670D\u52A1
      mode === 'mock' &&
      viteMockServe({
        // default
        mockPath: 'mock'
      }),
      // \u6784\u5EFA\u4EA7\u7269\u5206\u6790
      VITE_BUILD_ANALYZER &&
      visualizer({
        // \u6253\u5305\u5B8C\u6210\u540E\u81EA\u52A8\u6253\u5F00\u6D4F\u89C8\u5668\uFF0C\u663E\u793A\u4EA7\u7269\u4F53\u79EF\u62A5\u544A
        open: true,
        gzipSize: true,
        brotliSize: true
      }),
    ]
  };
});
`,paraId:1,tocIndex:2}]},48612:function(o,e,n){n.r(e),n.d(e,{texts:function(){return t}});var a=n(47194);const t=[{value:"\u5B50\u5E94\u7528\u7684\u6839\u8282\u70B9\u9700\u8981\u7531\u539F\u6765\u7684 ",paraId:0,tocIndex:0},{value:"#root",paraId:0,tocIndex:0},{value:" \u8BBE\u7F6E\u4E3A ",paraId:0,tocIndex:0},{value:"#\u5B50\u5E94\u7528\u540D-root",paraId:0,tocIndex:0},{value:`<div id="%VITE_REACT_APP_NAME%-root"></div>
`,paraId:1,tocIndex:1},{value:"\u4F7F\u7528\u65F6\u4E5F\u9700\u8981\u7531\u539F\u6765\u7684 ",paraId:2,tocIndex:2},{value:"#root",paraId:2,tocIndex:2},{value:" \u6539\u4E3A\u5BF9\u5E94\u7684 ",paraId:2,tocIndex:2},{value:"#\u5B50\u5E94\u7528\u540D-root",paraId:2,tocIndex:2},{value:`import '@assets/styles/index.less';

import ReactDOM from 'react-dom/client';
import {
  QiankunProps,
  qiankunWindow,
} from 'vite-plugin-qiankun/dist/helper';
import App from './App';
import { ConfigProvider } from 'antd';
import locale from 'antd/locale/zh_CN';
import dayjs from 'dayjs';

import 'dayjs/locale/zh-cn';

dayjs.locale('zh-cn');

const { VITE_REACT_APP_NAME, VITE_ANT_PREFIXCLS } = import.meta.env;

const rootDom = \`\${VITE_REACT_APP_NAME}-root\`;

let root: ReactDOM.Root | null = null;

const render = (props: QiankunProps) => {
  const { container, ...restProps } = props;
  // \u5982\u679C\u662F\u5728\u4E3B\u5E94\u7528\u7684\u73AF\u5883\u4E0B\u5C31\u6302\u8F7D\u4E3B\u5E94\u7528\u7684\u8282\u70B9\uFF0C\u5426\u5219\u6302\u8F7D\u5230\u672C\u5730
  const mountNode = (container
    ? container?.querySelector(\`#\${rootDom}\`)
    : document.getElementById(rootDom)) as HTMLElement;

  root = ReactDOM.createRoot(mountNode);
  root.render(
    <ConfigProvider locale={locale} prefixCls={VITE_ANT_PREFIXCLS}>
      <App {...restProps} />
    </ConfigProvider>
  );
};
`,paraId:3,tocIndex:2},{value:`import { qiankunWindow } from 'vite-plugin-qiankun/dist/helper';

// \u5224\u65AD\u5F53\u524D\u5E94\u7528\u662F\u5426\u5728\u4E3B\u5E94\u7528\u4E2D
qiankunWindow.__POWERED_BY_QIANKUN__ ? initQianKun() : render({});
`,paraId:4,tocIndex:3},{value:`import {
  QiankunProps,
  ,
} from 'vite-plugin-qiankun/dist/helper';

const initQianKun = () => {
  ({
    // \u5F53\u524D\u5E94\u7528\u5728\u4E3B\u5E94\u7528\u4E2D\u7684\u751F\u547D\u5468\u671F
    // \u6587\u6863 https://qiankun.umijs.org/zh/guide/getting-started#

    mount(props: QiankunProps) {
      render(props);
    },
    update() { },
    bootstrap() {
      console.log('react app bootstraped');
    },
    unmount() {
      root?.unmount();
      root = null;
    }
  });
};
`,paraId:5,tocIndex:4}]},9971:function(o,e,n){n.r(e),n.d(e,{texts:function(){return t}});var a=n(78991);const t=[{value:"\u5B50\u5E94\u7528\u9700\u8981\u5224\u65AD\uFF0C\u5982\u679C\u5728 ",paraId:0,tocIndex:1},{value:"qiankun",paraId:0,tocIndex:1},{value:" \u73AF\u5883\u4E0B\uFF0C\u9700\u8981\u4F7F\u7528\u4E3B\u5E94\u7528\u4F20\u8FC7\u6765\u7684\u6839\u8DEF\u5F84\u4F5C\u4E3A\u5B50\u5E94\u7528\u7684 ",paraId:0,tocIndex:1},{value:"basename",paraId:0,tocIndex:1},{value:`/*
 * react-router-dom \u5B98\u65B9\u6587\u6863
 * https://reactrouter.com/en/main
 */
import Suspenselazy from '@/components/Suspenselazy';
import { RouteObject, createBrowserRouter } from 'react-router-dom';
import { qiankunWindow } from 'vite-plugin-qiankun/dist/helper';

import { isLocal } from '@/utils/env';

const Home = Suspenselazy(
  () => import(/* webpackChunkName:"Home" */ '@/pages/Home')
);
const Foo = Suspenselazy(
  () => import(/* webpackChunkName:"Foo" */ '@/pages/Foo')
);

const Empty = Suspenselazy(
  () => import(/* webpackChunkName:"Empty" */ '@/pages/Empty')
);

const routes: RouteObject[] = [
  {
    path: '/',
    element: Home
  },
  {
    path: 'foo',
    element: Foo
  },
  {
    path: 'empty',
    element: Empty
  },
  // \u672A\u5339\u914D\u5230\u9875\u9762
  {
    path: '*',
    element: Empty
  }
];

const { VITE_BASE_ROUTE_NAME } = import.meta.env;

function getRouter(rootBasename?: string) {

  return createBrowserRouter(routes, {
    // \u8BBE\u7F6Ebasename
    basename: qiankunWindow.__POWERED_BY_QIANKUN__
      ? rootBasename
      : isLocal
        ? '/'
        : VITE_BASE_ROUTE_NAME
  });
}

export default getRouter;

`,paraId:1,tocIndex:1}]},51446:function(o,e,n){n.r(e),n.d(e,{texts:function(){return t}});var a=n(68537);const t=[]},48320:function(o,e,n){n.r(e),n.d(e,{texts:function(){return t}});var a=n(42077);const t=[{value:"activeRule",paraId:0,tocIndex:1},{value:" \u4E0D\u80FD\u548C\u5FAE\u5E94\u7528\u7684\u771F\u5B9E\u8BBF\u95EE\u8DEF\u5F84\u4E00\u6837\uFF0C\u5426\u5219\u5728\u4E3B\u5E94\u7528\u9875\u9762\u5237\u65B0\u4F1A\u76F4\u63A5\u53D8\u6210\u5FAE\u5E94\u7528\u9875\u9762\u3002",paraId:0,tocIndex:1},{value:"\u4F8B\u5982\uFF1A",paraId:1,tocIndex:1},{value:"\u5B50\u5E94\u7528\u7684\u771F\u5B9E\u8BBF\u95EE\u5730\u5740\u4E3A",paraId:2,tocIndex:1},{value:"https://ops.test.xxx.com/gatekeeper/qiankun-mic-a",paraId:2,tocIndex:1},{value:"\u4E3B\u5E94\u7528\u7684\u771F\u5B9E\u8BBF\u95EE\u5730\u5740\u4E3A",paraId:3,tocIndex:1},{value:"https://ops.test.xxx.com/gatekeeper",paraId:3,tocIndex:1},{value:"\u4E3B\u5E94\u7528\u5728\u8BBE\u7F6E\u5B50\u5E94\u7528\u7684",paraId:4,tocIndex:1},{value:"activeRule",paraId:4,tocIndex:1},{value:"\u65F6\u4E0D\u80FD\u8BBE\u7F6E\u6210",paraId:4,tocIndex:1},{value:"qiankun-mic-a",paraId:4,tocIndex:1},{value:"\u89E3\u51B3\u65B9\u6CD5\uFF1A\u53EF\u4EE5\u53D6\u4E2A\u522B\u540D\u8D4B\u503C\u7ED9",paraId:5,tocIndex:1},{value:"activeRule",paraId:5,tocIndex:1},{value:"\uFF0C\u4F8B\u5982 ",paraId:5,tocIndex:1},{value:"child-a",paraId:5,tocIndex:1},{value:"\u5404\u4E2A\u5E94\u7528\u6837\u5F0F\u9694\u79BB \u8FD9\u4E2A\u95EE\u9898\u4E7E\u5764\u6846\u67B6\u505A\u4E86\u4E00\u5B9A\u7684\u5904\u7406\uFF0C\u5728\u8FD0\u884C\u65F6\u6709\u4E00\u4E2A sandbox \u7684\u53C2\u6570\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u6C99\u7BB1\u53EF\u4EE5\u786E\u4FDD\u5355\u5B9E\u4F8B\u573A\u666F\u5B50\u5E94\u7528\u4E4B\u95F4\u7684\u6837\u5F0F\u9694\u79BB\uFF0C\u4F46\u662F\u65E0\u6CD5\u786E\u4FDD\u4E3B\u5E94\u7528\u8DDF\u5B50\u5E94\u7528\u3001\u6216\u8005\u591A\u5B9E\u4F8B\u573A\u666F\u7684\u5B50\u5E94\u7528\u6837\u5F0F\u9694\u79BB\u3002\u5982\u679C\u8981\u89E3\u51B3\u4E3B\u5E94\u7528\u548C\u5B50\u5E94\u7528\u7684\u6837\u5F0F\u95EE\u9898\uFF0C\u76EE\u524D\u6709 2 \u79CD\u65B9\u5F0F\uFF1A",paraId:6,tocIndex:2},{value:"\u5728\u4E7E\u5764\u4E2D\u914D\u7F6E { strictStyleIsolation: true } \u65F6\u8868\u793A\u5F00\u542F\u4E25\u683C\u7684\u6837\u5F0F\u9694\u79BB\u6A21\u5F0F\u3002\u8FD9\u79CD\u6A21\u5F0F\u4E0B qiankun \u4F1A\u4E3A\u6BCF\u4E2A\u5FAE\u5E94\u7528\u7684\u5BB9\u5668\u5305\u88F9\u4E0A\u4E00\u4E2A shadow dom \u8282\u70B9\uFF0C\u4ECE\u800C\u786E\u4FDD\u5FAE\u5E94\u7528\u7684\u6837\u5F0F\u4E0D\u4F1A\u5BF9\u5168\u5C40\u9020\u6210\u5F71\u54CD\u3002\u4F46\u662F\u57FA\u4E8E ShadowDOM \u7684\u4E25\u683C\u6837\u5F0F\u9694\u79BB\u5E76\u4E0D\u662F\u4E00\u4E2A\u53EF\u4EE5\u65E0\u8111\u4F7F\u7528\u7684\u65B9\u6848\uFF0C\u5927\u90E8\u5206\u60C5\u51B5\u4E0B\u90FD\u9700\u8981\u63A5\u5165\u5E94\u7528\u505A\u4E00\u4E9B\u9002\u914D\u540E\u624D\u80FD\u6B63\u5E38\u5728 ShadowDOM \u4E2D\u8FD0\u884C\u8D77\u6765\uFF0C\u8FD9\u4E2A\u5728 qiankun \u7684 issue \u91CC\u9762\u6709\u4E00\u4E9B\u8BA8\u8BBA\u548C\u4F7F\u7528\u7ECF\u9A8C\u3002",paraId:7,tocIndex:3},{value:"BEM",paraId:8,tocIndex:4},{value:" \u89C4\u8303\u6216\u7EDF\u4E00\u7ED9\u6240\u6709\u9009\u62E9\u5668\u540D\u6DFB\u52A0\u524D\u7F00\uFF0C\u6BD4\u5982 antd \u4F8B\u5B50\uFF1A",paraId:8,tocIndex:4},{value:"vite",paraId:9,tocIndex:4},{value:"\u914D\u7F6E\uFF1A",paraId:9,tocIndex:4},{value:`css: {
  // \u8FDB\u884C PostCSS \u914D\u7F6E
  postcss: {
    preprocessorOptions: {
      less: {
        modifyVars: {
          '@ant-prefix': 'yourPrefix'
        },
      }
    }
  }
},
`,paraId:10,tocIndex:4},{value:"\u914D\u7F6E ",paraId:11,tocIndex:4},{value:"antd ConfigProvider",paraId:11,tocIndex:4},{value:"\uFF1A",paraId:11,tocIndex:4},{value:`import { ConfigProvider } from 'antd';

<ConfigProvider prefixCls="yourPrefix">
  <App />
</ConfigProvider>;
`,paraId:12,tocIndex:4},{value:"CSS Modules",paraId:13,tocIndex:5},{value:" \u662F\u89E3\u51B3\u547D\u540D\u7A7A\u95F4\u95EE\u9898\u7684\u4E00\u79CD\u65B9\u6848\uFF0C\u5B83\u53EF\u4EE5\u57FA\u4E8E\u6307\u5B9A\u7684\u89C4\u5219\u751F\u6210\u9009\u62E9\u5668\u540D\u79F0\uFF0C\u65E0\u9700\u5F00\u53D1\u8005\u9075\u5B88\u4E25\u683C\u7684\u89C4\u8303\uFF0C\u540C\u65F6\u4E5F\u907F\u514D\u5BF9\u5168\u5C40\u6837\u5F0F\u9020\u6210\u6C61\u67D3\u3002",paraId:13,tocIndex:5},{value:"\u7531\u4E8E\u9009\u62E9\u5668\u540D\u79F0\u90FD\u662F\u52A8\u6001\u751F\u6210\u7684\uFF0C\u6240\u4EE5\u5F00\u53D1\u65F6\u4E0D\u9700\u8981\u9075\u5B88\u547D\u540D\u89C4\u8303\uFF0C\u4E5F\u65E0\u9700\u8003\u8651\u547D\u540D\u51B2\u7A81\u3002",paraId:14,tocIndex:6},{value:`import styled from 'styled-components';
const Test = styled.div\`
  color: red;
\`;
// ...
<Test />;
`,paraId:15,tocIndex:6},{value:"Tailwind CSS",paraId:16,tocIndex:7},{value:" \u662F\u4E00\u4E2A\u53EF\u5B9A\u5236\u5316\u7684 CSS \u6846\u67B6\uFF0C\u6700\u5927\u7684\u7279\u70B9\u662F\u529F\u80FD\u7C7B\u4F18\u5148\uFF0C\u548C\u6211\u4EEC\u77E5\u9053\u7684 bootstrap\uFF0Celement ui\uFF0Cantd\uFF0Cveui \u7B49\u6846\u67B6\u4E00\u6837\u3002\u5C06\u4E00\u4E9B CSS \u6837\u5F0F\u5C01\u88C5\u597D\uFF0C\u7528\u6765\u52A0\u901F\u6211\u4EEC\u5F00\u53D1\u7684\u4E00\u4E2A\u5DE5\u5177",paraId:16,tocIndex:7},{value:"\u5728\u6CE8\u518C\u5B50\u5E94\u7528\u65F6\uFF0C\u53EF\u4EE5\u5C06\u4E3B\u5E94\u7528\u7684\u6570\u636E\u6216\u65B9\u6CD5\u901A\u8FC7 props \u4F20\u9012\u7ED9\u5B50\u5E94\u7528\uFF1A",paraId:17,tocIndex:9},{value:`import { registerMicroApps } from 'qiankun';

registerMicroApps([
  {
    name: 'app1',
    entry: '//localhost:8080',
    container: '#container',
    activeRule: '/react',
    props: {
      name: 'kuitos',
      func: {
        getSomething, //\u4F20\u9012\u65B9\u6CD5
      },
    },
  },
]);
`,paraId:18,tocIndex:9},{value:"\u5B50\u5E94\u7528\u4F7F\u7528\uFF1A",paraId:19,tocIndex:9},{value:`export function mount(props) {
  const { name, func } = props;
  console.log(name, func);
  render(props);
}
`,paraId:20,tocIndex:9},{value:"\u4E3B\u5E94\u7528\uFF1A",paraId:21,tocIndex:10},{value:`import { initGlobalState, MicroAppStateActions } from 'qiankun';

// \u521D\u59CB\u5316 state
const actions: MicroAppStateActions = initGlobalState(state);

actions.onGlobalStateChange((state, prev) => {
  // state: \u53D8\u66F4\u540E\u7684\u72B6\u6001; prev \u53D8\u66F4\u524D\u7684\u72B6\u6001
  console.log(state, prev);
});
actions.setGlobalState(state);
actions.offGlobalStateChange();
`,paraId:22,tocIndex:10},{value:"\u5B50\u5E94\u7528\uFF1A",paraId:23,tocIndex:10},{value:`// \u4ECE\u751F\u547D\u5468\u671F mount \u4E2D\u83B7\u53D6\u901A\u4FE1\u65B9\u6CD5\uFF0C\u4F7F\u7528\u65B9\u5F0F\u548C master \u4E00\u81F4
export function mount(props) {
  props.onGlobalStateChange((state, prev) => {
    // state: \u53D8\u66F4\u540E\u7684\u72B6\u6001; prev \u53D8\u66F4\u524D\u7684\u72B6\u6001
    console.log(state, prev);
  });

  props.setGlobalState(state);
}
`,paraId:24,tocIndex:10},{value:"\u4E3B\u5E94\u7528\u548C\u5B50\u5E94\u7528\u662F\u5171\u4EAB window \u53D8\u91CF\u7684\uFF0C\u5373\u8BBE\u7F6E\u548C\u4FEE\u6539 window \u53D8\u91CF\uFF0C\u4E3B\u5E94\u7528\u548C\u5B50\u5E94\u7528\u90FD\u4F1A\u53D7\u5230\u5F71\u54CD\u3002",paraId:25,tocIndex:12},{value:"\u539F\u56E0\uFF1Aqiankun \u4E2D\u7684\u4EE3\u7801\u4F7F\u7528 Proxy \u53BB\u4EE3\u7406\u7236\u9875\u9762\u7684 window\uFF0C\u6765\u5B9E\u73B0\u7684\u6C99\u7BB1\uFF0C\u5728\u5FAE\u5E94\u7528\u4E2D\u8BBF\u95EE window.Vue \u65F6\uFF0C\u4F1A\u5148\u5728\u81EA\u5DF1\u7684 window \u91CC\u67E5\u627E\u6709\u6CA1\u6709 Vue \u5C5E\u6027\uFF0C\u5982\u679C\u6CA1\u6709\u5C31\u53BB\u7236\u5E94\u7528\u91CC\u67E5\u627E\u3002",paraId:26,tocIndex:12},{value:"\u5B50\u5E94\u7528\u548C\u5B50\u5E94\u7528\u4E4B\u95F4\u7684 window \u53D8\u91CF\u662F\u9694\u79BB\u7684\uFF0C\u5373\u8BBE\u7F6E\u548C\u4FEE\u6539\u5404\u81EA\u7684 window \u53D8\u91CF\uFF0C\u4E92\u4E0D\u5F71\u54CD",paraId:27,tocIndex:13}]}}]);
